/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={39:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0,t.Player=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=t.id||"local_player",this.isLocalPlayer=void 0===t.isLocalPlayer||t.isLocalPlayer,this.position=t.position||{x:0,y:0,z:0},this.rotation=t.rotation||{x:0,y:0,z:0},this.direction={x:0,z:-1},this.health=t.health||100,this.maxHealth=t.maxHealth||100,this.speed=t.speed||5,this.weapon=t.weapon||"pistol",this.ammo=t.ammo||30,this.weaponType="single",this.fireRate=500,this.recoil={x:.05,y:.05},this.inventory=t.inventory||{items:[],maxSlots:25},this.isMoving=!1,this.isRunning=!1,this.isAiming=!1,this.isShooting=!1,this.canShoot=!0,this.lastShootTime=0,this.currentState="idle",this.viewAngle=90,this.normalViewAngle=90,this.aimingViewAngle=45,this.runningViewAngle=70,this.viewDistance=50,this.normalSpeed=5,this.runningSpeed=7.5,this.aimingSpeed=1.5,this.acceleration=10,this.velocity={x:0,z:0},this.renderer=t.renderer,this.input=t.input,this.game=t.game,this.mesh=null,this.isLocalPlayer&&this.setupControls(),this.createModel()},(t=[{key:"createModel",value:function(){this.renderer&&(this.mesh=this.renderer.addPlayer({position:this.position,rotation:this.rotation,isLocalPlayer:this.isLocalPlayer}))}},{key:"setupControls",value:function(){var e=this;this.input&&(this.input.setMouseDownCallback((function(t,n){0===t&&e.startAiming()})),this.input.setMouseUpCallback((function(t){0===t&&e.stopAiming()})),this.input.setRightClickCallback((function(){e.tryShoot()})),this.input.setMouseMoveCallback((function(t,n){e.handleMouseMove(t)})))}},{key:"startAiming",value:function(){this.isAiming=!0,this.speed=this.aimingSpeed,this.viewAngle=this.aimingViewAngle,console.log("Начало прицеливания")}},{key:"stopAiming",value:function(){this.isAiming=!1,this.speed=this.normalSpeed,this.viewAngle=this.normalViewAngle,console.log("Конец прицеливания")}},{key:"tryShoot",value:function(){var e=this;if(this.isAiming&&this.canShoot&&!(this.ammo<=0)){var t=Date.now();t-this.lastShootTime<this.fireRate||(this.lastShootTime=t,this.ammo--,this.isShooting=!0,setTimeout((function(){e.isShooting=!1}),100),this.applyRecoil(),this.createShot(),"single"===this.weaponType&&(this.canShoot=!1,setTimeout((function(){e.canShoot=!0}),this.fireRate)),this.game&&this.game.network&&this.game.network.sendPlayerShoot(this.position,this.direction,this.weapon))}}},{key:"applyRecoil",value:function(){var e=(Math.random()-.5)*this.recoil.x*2,t=-Math.abs(Math.random()*this.recoil.y),n=this.input.getMousePosition(),i={x:n.x+100*e,y:n.y+100*t};this.handleMouseMove(i)}},{key:"handleMouseMove",value:function(e){var t=this.renderer.canvas.getBoundingClientRect(),n=t.left+t.width/2,i=t.top+t.height/2,r={x:e.x-n,y:e.y-i},o=Math.sqrt(r.x*r.x+r.y*r.y);o>0&&(r.x/=o,r.y/=o);var a=Math.atan2(r.x,-r.y);this.rotation.y=a,this.direction={x:Math.sin(a),z:-Math.cos(a)}}},{key:"update",value:function(e){e&&(this.isLocalPlayer&&(this.handleMovement(e),this.renderer&&this.renderer.updateCamera(this.position),this.handleRunning(),this.updateAnimationState()),this.updateModel())}},{key:"handleRunning",value:function(){if(this.input){var e=this.isRunning;this.input.isKeyPressed("ShiftLeft")&&!this.isAiming?this.isRunning||(this.isRunning=!0,this.speed=this.runningSpeed,this.viewAngle=this.runningViewAngle):this.isRunning&&(this.isRunning=!1,this.speed=this.isAiming?this.aimingSpeed:this.normalSpeed,this.viewAngle=this.isAiming?this.aimingViewAngle:this.normalViewAngle),e!==this.isRunning&&console.log(this.isRunning?"Начало бега":"Конец бега")}}},{key:"updateAnimationState",value:function(){var e="idle";this.isMoving&&(e=this.isRunning?"run":"walk"),this.isAiming&&(e="aim"),this.isShooting&&(e="shoot"),this.currentState!==e&&(this.currentState=e,console.log("Состояние анимации: ".concat(this.currentState)))}},{key:"handleMovement",value:function(e){if(this.input){var t=this.input.getMovementDirection();if(0===t.x&&0===t.z)this.velocity.x*=.9,this.velocity.z*=.9,Math.abs(this.velocity.x)<.01&&Math.abs(this.velocity.z)<.01&&(this.velocity.x=0,this.velocity.z=0,this.isMoving=!1);else{this.isMoving=!0;var n=Math.sqrt(t.x*t.x+t.z*t.z),i={x:t.x/n,z:t.z/n},r={x:i.x*this.speed,z:i.z*this.speed};this.velocity.x+=(r.x-this.velocity.x)*this.acceleration*e,this.velocity.z+=(r.z-this.velocity.z)*this.acceleration*e}var o=this.position.x+this.velocity.x*e,a=this.position.z+this.velocity.z*e,s=this.checkCollision({x:o,y:this.position.y,z:this.position.z}),c=this.checkCollision({x:this.position.x,y:this.position.y,z:a});s?this.position.x=o:this.velocity.x=0,c?this.position.z=a:this.velocity.z=0,this.game&&this.game.network&&this.game.network.sendPlayerMove(this.position,this.rotation)}}},{key:"checkCollision",value:function(e){return!(Math.abs(e.x)>500||Math.abs(e.z)>500)}},{key:"createShot",value:function(){if(this.renderer&&this.renderer.scene){var e=r({},this.position);e.y+=1;var t={x:e.x+100*this.direction.x,y:e.y,z:e.z+100*this.direction.z};this.renderer.createTemporaryBeam(e,t,16711680,100),console.log("Выстрел!",this.direction)}}},{key:"updateModel",value:function(){this.mesh&&this.renderer&&this.renderer.updateObjectTransform(this.mesh,this.position,this.rotation)}},{key:"getViewAngle",value:function(){return this.viewAngle}},{key:"getViewDistance",value:function(){return this.viewDistance}},{key:"getViewDirection",value:function(){return r({},this.direction)}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},91:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicsManager=void 0;var i=n(440);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,a,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(s.push(i.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function c(){c=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var r=t&&t.prototype instanceof b?t:b,a=Object.create(r.prototype),s=new A(i||[]);return o(a,"_invoke",{value:C(e,n,s)}),a}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function E(){}var k={};h(k,s,(function(){return this}));var x=Object.getPrototypeOf,R=x&&x(x(O([])));R&&R!==n&&i.call(R,s)&&(k=R);var S=E.prototype=b.prototype=Object.create(k);function M(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function n(o,a,s,c){var l=y(e[o],e,a);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==r(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,c)}))}c(l.arg)}var a;o(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return a=a?a.then(r,r):r()}})}function C(t,n,i){var r=f;return function(o,a){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=j(s,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var l=y(t,n,i);if("normal"===l.type){if(r=i.done?v:p,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=v,i.method="throw",i.arg=l.arg)}}}function j(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var o=y(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(i.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return w.prototype=E,o(S,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:w,configurable:!0}),w.displayName=h(E,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,h(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(P.prototype),h(P.prototype,l,(function(){return this})),t.AsyncIterator=P,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new P(d(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(S),h(S,u,"Generator"),h(S,s,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:O(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function l(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){l(o,i,r,a,s,"next",e)}function s(e){l(o,i,r,a,s,"throw",e)}a(void 0)}))}}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function d(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}t.PhysicsManager=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.world=null,this.bodies=new Map,this.colliders=new Map,this.isInitialized=!1,this.RAPIER=null,this.initPromise=null},t=[{key:"init",value:(n=u(c().mark((function e(){var t=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.initPromise){e.next=2;break}return e.abrupt("return",this.initPromise);case 2:return this.initPromise=new Promise(function(){var e=u(c().mark((function e(n){var r,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("PhysicsManager: начало инициализации..."),e.next=4,(0,i.initRapier)();case 4:if(t.RAPIER=e.sent,t.RAPIER||(0,i.isRapierAvailable)()){e.next=9;break}return console.error("PhysicsManager: RAPIER не определен. Убедитесь, что библиотека загружена."),n(!1),e.abrupt("return");case 9:if(t.RAPIER){e.next=15;break}if(t.RAPIER=(0,i.getRapier)(),t.RAPIER){e.next=15;break}return console.error("PhysicsManager: не удалось получить объект RAPIER."),n(!1),e.abrupt("return");case 15:if(console.log("PhysicsManager: создание физического мира..."),o={x:0,y:-9.81,z:0},"function"!=typeof t.RAPIER.World){e.next=21;break}t.world=new t.RAPIER.World(o),e.next=28;break;case 21:if("function"!=typeof(null===(r=t.RAPIER.World)||void 0===r?void 0:r.new)){e.next=25;break}t.world=t.RAPIER.World.new(o),e.next=28;break;case 25:return console.error("PhysicsManager: не удалось создать физический мир. Неподдерживаемый API."),n(!1),e.abrupt("return");case 28:t.isInitialized=!0,console.log("PhysicsManager: физический движок успешно инициализирован."),n(!0),e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),console.error("PhysicsManager: ошибка при инициализации физики:",e.t0),t.isInitialized=!1,n(!1);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",this.initPromise);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"isReady",value:function(){return this.isInitialized&&null!==this.world}},{key:"getWorld",value:function(){return this.world}},{key:"update",value:function(e){if(this.isReady())try{"function"==typeof this.world.step?this.world.step():"function"==typeof this.world.timestep&&this.world.timestep(e||1/60),this.updateBodies()}catch(e){console.error("PhysicsManager: ошибка при обновлении физики:",e)}}},{key:"updateBodies",value:function(){try{var e,t=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=a(e))){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw r}}}}(this.bodies);try{for(t.s();!(e=t.n()).done;){var n=o(e.value,2),i=n[0],r=n[1];if(i&&i.position&&r){var s=void 0;if("function"==typeof r.translation)s=r.translation();else if("function"==typeof r.getTranslation)s=r.getTranslation();else{if(!r.translation)continue;s=r.translation}i.position.set(s.x,s.y,s.z),"function"==typeof i.updatePhysics&&i.updatePhysics(r)}}}catch(e){t.e(e)}finally{t.f()}}catch(e){console.error("PhysicsManager: ошибка при обновлении позиций объектов:",e)}}},{key:"createObstacle",value:function(e){if(!this.isReady())return null;try{var t,n=e.position||{x:0,y:0,z:0},i=e.size||{x:1,y:1,z:1};"function"==typeof this.RAPIER.RigidBodyDesc.fixed?t=this.RAPIER.RigidBodyDesc.fixed().setTranslation(n.x,n.y,n.z):(t=new this.RAPIER.RigidBodyDesc(this.RAPIER.RigidBodyType.Fixed)).translation={x:n.x,y:n.y,z:n.z};var r,o=this.world.createRigidBody(t);r="function"==typeof this.RAPIER.ColliderDesc.cuboid?this.RAPIER.ColliderDesc.cuboid(i.x/2,i.y/2,i.z/2):new this.RAPIER.ColliderDesc(new this.RAPIER.Cuboid(i.x/2,i.y/2,i.z/2));var a=this.world.createCollider(r,o);return e.object&&(this.bodies.set(e.object,o),this.colliders.set(e.object,a)),a}catch(e){return console.error("PhysicsManager: ошибка при создании препятствия:",e),null}}},{key:"createCharacter",value:function(e){if(!this.isReady())return null;try{var t,n=e.position||{x:0,y:0,z:0},i=e.radius||.5,r=e.height||1.8;"function"==typeof this.RAPIER.RigidBodyDesc.dynamic?t=this.RAPIER.RigidBodyDesc.dynamic().setTranslation(n.x,n.y,n.z).setCanSleep(!1).setLinearDamping(.2):((t=new this.RAPIER.RigidBodyDesc(this.RAPIER.RigidBodyType.Dynamic)).translation={x:n.x,y:n.y,z:n.z},t.canSleep=!1,t.linearDamping=.2);var o,a=this.world.createRigidBody(t);o="function"==typeof this.RAPIER.ColliderDesc.capsule?this.RAPIER.ColliderDesc.capsule(r/2-i,i):new this.RAPIER.ColliderDesc(new this.RAPIER.Capsule(r/2-i,i));var s=this.world.createCollider(o,a);return e.object&&(this.bodies.set(e.object,a),this.colliders.set(e.object,s)),a}catch(e){return console.error("PhysicsManager: ошибка при создании персонажа:",e),null}}},{key:"castRay",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;if(!this.isReady())return null;try{var i;return i="function"==typeof this.RAPIER.Ray?new this.RAPIER.Ray(e,t):{origin:e,direction:t},"function"==typeof this.world.castRay?this.world.castRay(i,n,!0):"function"==typeof this.world.castRayAndGetNormal?this.world.castRayAndGetNormal(e,t,n,!0):(console.warn("PhysicsManager: метод рейкаста не доступен"),null)}catch(e){return console.error("PhysicsManager: ошибка при выполнении рейкаста:",e),null}}},{key:"createGround",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isReady())return null;try{var t,n=e.normal||{x:0,y:1,z:0},i=e.offset||0;t="function"==typeof this.RAPIER.RigidBodyDesc.fixed?this.RAPIER.RigidBodyDesc.fixed():new this.RAPIER.RigidBodyDesc(this.RAPIER.RigidBodyType.Fixed);var r,o=this.world.createRigidBody(t);return r="function"==typeof this.RAPIER.ColliderDesc.halfspace?this.RAPIER.ColliderDesc.halfspace(n,i):new this.RAPIER.ColliderDesc(new this.RAPIER.HalfSpace(n,i)),this.world.createCollider(r,o)}catch(e){return console.error("PhysicsManager: ошибка при создании плоскости:",e),null}}},{key:"removeBody",value:function(e){try{if(this.bodies.has(e)){var t=this.bodies.get(e);this.world.removeRigidBody(t),this.bodies.delete(e)}this.colliders.has(e)&&this.colliders.delete(e)}catch(e){console.error("PhysicsManager: ошибка при удалении тела:",e)}}},{key:"dispose",value:function(){try{this.bodies.clear(),this.colliders.clear(),this.world&&("function"==typeof this.world.free&&this.world.free(),this.world=null),this.isInitialized=!1,this.initPromise=null,console.log("PhysicsManager: ресурсы освобождены")}catch(e){console.error("PhysicsManager: ошибка при освобождении ресурсов:",e)}}}],t&&h(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()},150:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.VisionSystem=void 0,t.VisionSystem=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.scene&&t.player?(this.scene=t.scene,this.world=t.world,this.player=t.player,this.fov=t.fov||90,this.rayCount=t.rayCount||60,this.maxDistance=t.maxDistance||50,this.memoryEnabled=void 0===t.memoryEnabled||t.memoryEnabled,this.blurEdges=void 0===t.blurEdges||t.blurEdges,this.visibilityMask=null,this.visibilityGroup=null,this.memoryMask=null,this.visibilityShape=null,this.memoryGrid=[],this.cellSize=t.cellSize||5,this.gridResolution=Math.ceil(1e3/this.cellSize),this.isInitialized=!1,this.init()):console.error("VisionSystem: не указаны обязательные параметры (scene, player)")},(t=[{key:"init",value:function(){try{this.initVisibilityMask(),this.memoryEnabled&&this.initMemoryMap(),this.isInitialized=!0,console.log("VisionSystem: успешно инициализирована")}catch(e){console.error("VisionSystem: ошибка при инициализации:",e)}}},{key:"initVisibilityMask",value:function(){this.visibilityGroup=new THREE.Group,this.scene.add(this.visibilityGroup);var e=new THREE.PlaneGeometry(1500,1500),t=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.9,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1});this.visibilityMask=new THREE.Mesh(e,t),this.visibilityMask.rotation.x=-Math.PI/2,this.visibilityMask.position.y=.2,this.visibilityMask.renderOrder=999,this.visibilityGroup.add(this.visibilityMask),this.visibilityShape=new THREE.Shape}},{key:"initMemoryMap",value:function(){this.memoryGrid=new Array(this.gridResolution);for(var e=0;e<this.gridResolution;e++)this.memoryGrid[e]=new Array(this.gridResolution).fill(0);var t=new THREE.PlaneGeometry(1500,1500,this.gridResolution,this.gridResolution),n=new THREE.MeshBasicMaterial({color:11184810,transparent:!0,opacity:.5,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,vertexColors:!0});this.memoryMask=new THREE.Mesh(t,n),this.memoryMask.rotation.x=-Math.PI/2,this.memoryMask.position.y=.1,this.memoryMask.renderOrder=998,this.visibilityGroup.add(this.memoryMask);for(var i=[],r=t.attributes.position.array,o=0;o<r.length;o+=3)i.push(0,0,0);t.setAttribute("color",new THREE.Float32BufferAttribute(i,3))}},{key:"update",value:function(){var e=this;if(this.isInitialized&&this.player&&this.world)try{for(var t=this.player.position,n=this.player.getViewDirection(),i="function"==typeof this.player.getViewAngle?this.player.getViewAngle():this.fov,r={x:t.x,y:t.y+1,z:t.z},o=Math.atan2(n.x,n.z),a=i/2*(Math.PI/180),s=[],c=0;c<this.rayCount;c++){var l=o-a+c/(this.rayCount-1)*2*a;s.push(l)}var u=[];u.push(new THREE.Vector2(0,0)),s.forEach((function(t){var n,i={x:Math.sin(t),y:0,z:Math.cos(t)};if("function"==typeof e.world.castRayAndGetNormal){var o=e.world.castRayAndGetNormal(r,i,e.maxDistance,!0),a=o.hasHit?o:null;if(null!==a&&a.hasHit){var s=.99*a.toi;n={x:r.x+i.x*s,z:r.z+i.z*s}}else n={x:r.x+i.x*e.maxDistance,z:r.z+i.z*e.maxDistance}}else if("function"==typeof e.world.castRay){var c=new RAPIER.Ray(r,i),l=e.world.castRay(c,e.maxDistance,!0);if(null!==l){var h=l.toi*e.maxDistance*.99;n={x:r.x+i.x*h,z:r.z+i.z*h}}else n={x:r.x+i.x*e.maxDistance,z:r.z+i.z*e.maxDistance}}else console.warn("VisionSystem: методы рейкаста недоступны, используем максимальную дистанцию"),n={x:r.x+i.x*e.maxDistance,z:r.z+i.z*e.maxDistance};u.push(new THREE.Vector2(n.x-r.x,n.z-r.z)),e.memoryEnabled&&e.markVisitedArea(n.x,n.z)})),u.push(u[1].clone()),this.updateVisibilityShape(u),this.memoryEnabled&&this.updateMemoryMap()}catch(e){console.error("VisionSystem: ошибка при обновлении:",e)}}},{key:"updateVisibilityShape",value:function(e){if(!e||e.length<3)console.warn("VisionSystem: недостаточно точек для создания формы видимости");else try{var t=new THREE.Shape;t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);var i=2*this.maxDistance,r=new THREE.Shape;if(r.moveTo(-i,-i),r.lineTo(i,-i),r.lineTo(i,i),r.lineTo(-i,i),r.lineTo(-i,-i),r.holes.push(t),this.visibilityMask){this.visibilityMask.geometry&&this.visibilityMask.geometry.dispose(),this.visibilityMask.geometry=new THREE.ShapeGeometry(r);var o=this.player.position;this.visibilityMask.position.set(o.x,.2,o.z)}}catch(e){console.error("VisionSystem: ошибка при обновлении формы видимости:",e)}}},{key:"markVisitedArea",value:function(e,t){var n=Math.floor((e+500)/this.cellSize),i=Math.floor((t+500)/this.cellSize);if(n>=0&&n<this.gridResolution&&i>=0&&i<this.gridResolution){this.memoryGrid[n][i]=1;for(var r=-1;r<=1;r++)for(var o=-1;o<=1;o++){var a=n+r,s=i+o;a>=0&&a<this.gridResolution&&s>=0&&s<this.gridResolution&&(this.memoryGrid[a][s]=Math.max(this.memoryGrid[a][s],.7))}}}},{key:"updateMemoryMap",value:function(){if(this.memoryEnabled&&this.memoryMask)try{var e=this.memoryMask.geometry,t=e.attributes.color;if(!t){var n=e.attributes.position.array,i=new Float32Array(n.length);t=new THREE.BufferAttribute(i,3),e.setAttribute("color",t)}for(var r=e.attributes.position.array,o=0,a=0;o<r.length;o+=3,a++){var s=r[o],c=r[o+2],l=Math.floor((s+500)/this.cellSize),u=Math.floor((c+500)/this.cellSize);if(l>=0&&l<this.gridResolution&&u>=0&&u<this.gridResolution){var h=this.memoryGrid[l][u];t.array[o]=h,t.array[o+1]=h,t.array[o+2]=h}}t.needsUpdate=!0}catch(e){console.error("VisionSystem: ошибка при обновлении карты посещенных областей:",e)}}},{key:"dispose",value:function(){try{this.visibilityMask&&(this.visibilityMask.geometry&&this.visibilityMask.geometry.dispose(),this.visibilityMask.material&&this.visibilityMask.material.dispose(),this.visibilityGroup.remove(this.visibilityMask)),this.memoryMask&&(this.memoryMask.geometry&&this.memoryMask.geometry.dispose(),this.memoryMask.material&&this.memoryMask.material.dispose(),this.visibilityGroup.remove(this.memoryMask)),this.visibilityGroup&&this.scene.remove(this.visibilityGroup),this.visibilityMask=null,this.memoryMask=null,this.visibilityGroup=null,this.memoryGrid=[],this.isInitialized=!1,console.log("VisionSystem: ресурсы успешно освобождены")}catch(e){console.error("VisionSystem: ошибка при освобождении ресурсов:",e)}}}])&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},172:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.HUD=void 0,t.HUD=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.healthBar=t.querySelector("#health-bar .health-value"),this.ammoCounter=t.querySelector("#ammo-counter"),this.weaponInfo=t.querySelector("#weapon-info"),this.statusMessages=t.querySelector("#status-messages"),this.health=100,this.ammo=0,this.weapon="Нет",this.messages=[],this.messageTimer=null,this.initialize()},t=[{key:"initialize",value:function(){this.updateHealthBar(),this.updateAmmoCounter(),this.updateWeaponInfo()}},{key:"update",value:function(e){void 0!==e.health&&e.health!==this.health&&(this.health=e.health,this.updateHealthBar()),void 0!==e.ammo&&e.ammo!==this.ammo&&(this.ammo=e.ammo,this.updateAmmoCounter()),void 0!==e.weapon&&e.weapon!==this.weapon&&(this.weapon=e.weapon,this.updateWeaponInfo())}},{key:"updateHealthBar",value:function(){this.healthBar&&(this.healthBar.style.width="".concat(this.health,"%"),this.health>70?this.healthBar.style.backgroundColor="#4CAF50":this.health>30?this.healthBar.style.backgroundColor="#FFC107":this.healthBar.style.backgroundColor="#F44336")}},{key:"updateAmmoCounter",value:function(){this.ammoCounter&&(this.ammoCounter.textContent="".concat(this.ammo))}},{key:"updateWeaponInfo",value:function(){this.weaponInfo&&(this.weaponInfo.textContent=this.weapon)}},{key:"addStatusMessage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.messages.push({text:e,timestamp:Date.now(),duration:n}),this.updateStatusMessages(),null===this.messageTimer&&(this.messageTimer=setInterval((function(){t.checkMessagesTimeout()}),1e3))}},{key:"updateStatusMessages",value:function(){var e=this;this.statusMessages&&(this.statusMessages.innerHTML="",this.messages.forEach((function(t){var n=document.createElement("div");n.className="status-message",n.textContent=t.text,e.statusMessages.appendChild(n)})))}},{key:"checkMessagesTimeout",value:function(){var e=Date.now(),t=!1;this.messages=this.messages.filter((function(n){var i=e-n.timestamp>n.duration;return i&&(t=!0),!i})),t&&this.updateStatusMessages(),0===this.messages.length&&(clearInterval(this.messageTimer),this.messageTimer=null)}},{key:"show",value:function(){this.element.classList.remove("hidden")}},{key:"hide",value:function(){this.element.classList.add("hidden")}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},273:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.InventoryUI=void 0,t.InventoryUI=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.gridElement=t.querySelector(".inventory-grid"),this.equippedElement=t.querySelector(".equipped-items"),this.inventory={items:[],maxSlots:25},this.equipped={weapon:null,armor:null,helmet:null},this.initialize()},(t=[{key:"initialize",value:function(){this.createInventorySlots(),this.createEquippedSlots(),this.setupDragAndDrop()}},{key:"createInventorySlots",value:function(){if(this.gridElement){this.gridElement.innerHTML="";for(var e=0;e<this.inventory.maxSlots;e++){var t=document.createElement("div");t.className="inventory-slot",t.dataset.slotIndex=e,this.gridElement.appendChild(t)}}}},{key:"createEquippedSlots",value:function(){var e=this;this.equippedElement&&(this.equippedElement.innerHTML="",[{id:"weapon",label:"Оружие"},{id:"armor",label:"Броня"},{id:"helmet",label:"Шлем"}].forEach((function(t){var n=document.createElement("div");n.className="equipped-slot-container";var i=document.createElement("div");i.className="equipped-slot-label",i.textContent=t.label;var r=document.createElement("div");r.className="equipped-slot",r.dataset.slotType=t.id,n.appendChild(i),n.appendChild(r),e.equippedElement.appendChild(n)})))}},{key:"setupDragAndDrop",value:function(){this.element.querySelectorAll(".inventory-slot").forEach((function(e){e.addEventListener("click",(function(){console.log("Клик по слоту инвентаря:",e.dataset.slotIndex)}))})),this.element.querySelectorAll(".equipped-slot").forEach((function(e){e.addEventListener("click",(function(){console.log("Клик по слоту экипировки:",e.dataset.slotType)}))}))}},{key:"update",value:function(e){e&&(this.inventory=e,this.updateInventoryDisplay())}},{key:"updateEquipped",value:function(e){e&&(this.equipped=e,this.updateEquippedDisplay())}},{key:"updateInventoryDisplay",value:function(){var e=this.element.querySelectorAll(".inventory-slot");e.forEach((function(e){e.innerHTML="",e.classList.remove("filled")})),this.inventory.items.forEach((function(t,n){if(!(n>=e.length)){var i=e[n],r=document.createElement("div");switch(r.className="inventory-item",r.dataset.itemId=t.id,t.type){case"weapon":r.classList.add("item-weapon"),r.textContent="W";break;case"medkit":r.classList.add("item-medkit"),r.textContent="M";break;case"ammo":r.classList.add("item-ammo"),r.textContent="A";break;default:r.textContent="?"}i.appendChild(r),i.classList.add("filled")}}))}},{key:"updateEquippedDisplay",value:function(){var e=this.element.querySelector('.equipped-slot[data-slot-type="weapon"]');if(e&&(e.innerHTML="",this.equipped.weapon)){var t=document.createElement("div");t.className="equipped-item item-weapon",t.textContent="W",e.appendChild(t)}var n=this.element.querySelector('.equipped-slot[data-slot-type="armor"]');if(n&&(n.innerHTML="",this.equipped.armor)){var i=document.createElement("div");i.className="equipped-item item-armor",i.textContent="A",n.appendChild(i)}var r=this.element.querySelector('.equipped-slot[data-slot-type="helmet"]');if(r&&(r.innerHTML="",this.equipped.helmet)){var o=document.createElement("div");o.className="equipped-item item-helmet",o.textContent="H",r.appendChild(o)}}},{key:"addInventoryStyles",value:function(){var e=document.createElement("style");e.textContent="\n            .inventory-item {\n                width: 90%;\n                height: 90%;\n                margin: 5%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-weight: bold;\n                user-select: none;\n                cursor: pointer;\n            }\n            \n            .item-weapon {\n                background-color: #FF5722;\n            }\n            \n            .item-medkit {\n                background-color: #4CAF50;\n            }\n            \n            .item-ammo {\n                background-color: #FFC107;\n            }\n            \n            .item-armor {\n                background-color: #2196F3;\n            }\n            \n            .item-helmet {\n                background-color: #673AB7;\n            }\n            \n            .equipped-slot-container {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n            }\n            \n            .equipped-slot-label {\n                margin-bottom: 5px;\n                font-size: 14px;\n            }\n            \n            .equipped-item {\n                width: 90%;\n                height: 90%;\n                margin: 5%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                font-weight: bold;\n            }\n        ",document.head.appendChild(e)}},{key:"show",value:function(){document.querySelector("style[data-inventory-styles]")||this.addInventoryStyles(),this.element.classList.remove("hidden")}},{key:"hide",value:function(){this.element.classList.add("hidden")}}])&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},432:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=void 0,t.InputHandler=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keys={},this.mouse={position:{x:0,y:0},isDown:!1,rightIsDown:!1},this.lastMousePosition={x:0,y:0},this.keyCallbacks={},this.clickCallback=null,this.rightClickCallback=null,this.mouseMoveCallback=null,this.mouseDownCallback=null,this.mouseUpCallback=null,this.gameControlsEnabled=!0,this.mouseSensitivity=1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleContextMenu=this.handleContextMenu.bind(this),this.init()},t=[{key:"init",value:function(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mouseup",this.handleMouseUp),window.addEventListener("contextmenu",this.handleContextMenu),document.body.style.userSelect="none"}},{key:"handleKeyDown",value:function(e){this.keys[e.code]=!0,this.keyCallbacks[e.code]&&this.gameControlsEnabled&&this.keyCallbacks[e.code]()}},{key:"handleKeyUp",value:function(e){this.keys[e.code]=!1}},{key:"handleMouseMove",value:function(e){this.mouse.position.x=e.clientX,this.mouse.position.y=e.clientY;var t=(this.mouse.position.x-this.lastMousePosition.x)*this.mouseSensitivity,n=(this.mouse.position.y-this.lastMousePosition.y)*this.mouseSensitivity;this.lastMousePosition.x=this.mouse.position.x,this.lastMousePosition.y=this.mouse.position.y,this.mouseMoveCallback&&this.gameControlsEnabled&&this.mouseMoveCallback(this.mouse.position,{x:t,y:n})}},{key:"handleMouseDown",value:function(e){0===e.button?(this.mouse.isDown=!0,this.mouseDownCallback&&this.gameControlsEnabled&&this.mouseDownCallback(0,this.mouse.position),this.clickCallback&&this.gameControlsEnabled&&this.clickCallback(this.mouse.position)):2===e.button&&(this.mouse.rightIsDown=!0,this.mouseDownCallback&&this.gameControlsEnabled&&this.mouseDownCallback(2,this.mouse.position),this.rightClickCallback&&this.gameControlsEnabled&&this.rightClickCallback(this.mouse.position))}},{key:"handleMouseUp",value:function(e){0===e.button?(this.mouse.isDown=!1,this.mouseUpCallback&&this.gameControlsEnabled&&this.mouseUpCallback(0)):2===e.button&&(this.mouse.rightIsDown=!1,this.mouseUpCallback&&this.gameControlsEnabled&&this.mouseUpCallback(2))}},{key:"handleContextMenu",value:function(e){e.preventDefault()}},{key:"isKeyPressed",value:function(e){return this.gameControlsEnabled&&!0===this.keys[e]}},{key:"isMouseDown",value:function(){return this.gameControlsEnabled&&this.mouse.isDown}},{key:"isRightMouseDown",value:function(){return this.gameControlsEnabled&&this.mouse.rightIsDown}},{key:"getMousePosition",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.mouse.position)}},{key:"setMouseSensitivity",value:function(e){this.mouseSensitivity=e}},{key:"addKeyCallback",value:function(e,t){this.keyCallbacks[e]=t}},{key:"removeKeyCallback",value:function(e){delete this.keyCallbacks[e]}},{key:"setClickCallback",value:function(e){this.clickCallback=e}},{key:"setRightClickCallback",value:function(e){this.rightClickCallback=e}},{key:"setMouseMoveCallback",value:function(e){this.mouseMoveCallback=e}},{key:"setMouseDownCallback",value:function(e){this.mouseDownCallback=e}},{key:"setMouseUpCallback",value:function(e){this.mouseUpCallback=e}},{key:"disableGameControls",value:function(){this.gameControlsEnabled=!1}},{key:"enableGameControls",value:function(){this.gameControlsEnabled=!0}},{key:"getMovementDirection",value:function(){if(!this.gameControlsEnabled)return{x:0,z:0};var e=0,t=0;return this.isKeyPressed("KeyW")||this.isKeyPressed("ArrowUp")?t=-1:(this.isKeyPressed("KeyS")||this.isKeyPressed("ArrowDown"))&&(t=1),this.isKeyPressed("KeyA")||this.isKeyPressed("ArrowLeft")?e=-1:(this.isKeyPressed("KeyD")||this.isKeyPressed("ArrowRight"))&&(e=1),{x:e,z:t}}},{key:"clearCallbacks",value:function(){this.keyCallbacks={},this.clickCallback=null,this.rightClickCallback=null,this.mouseMoveCallback=null,this.mouseDownCallback=null,this.mouseUpCallback=null}},{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mousedown",this.handleMouseDown),window.removeEventListener("mouseup",this.handleMouseUp),window.removeEventListener("contextmenu",this.handleContextMenu),document.body.style.userSelect=""}}],t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},440:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return t};var e,t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var r=t&&t.prototype instanceof b?t:b,o=Object.create(r.prototype),s=new A(i||[]);return a(o,"_invoke",{value:C(e,n,s)}),o}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function E(){}var k={};h(k,c,(function(){return this}));var x=Object.getPrototypeOf,R=x&&x(x(O([])));R&&R!==r&&o.call(R,c)&&(k=R);var S=E.prototype=b.prototype=Object.create(k);function M(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function i(r,a,s,c){var l=y(e[r],e,a);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==n(h)&&o.call(h,"__await")?t.resolve(h.__await).then((function(e){i("next",e,s,c)}),(function(e){i("throw",e,s,c)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return i("throw",e,s,c)}))}c(l.arg)}var r;a(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(o,o):o()}})}function C(t,n,i){var r=f;return function(o,a){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=j(s,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var l=y(t,n,i);if("normal"===l.type){if(r=i.done?v:p,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=v,i.method="throw",i.arg=l.arg)}}}function j(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var o=y(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function O(t){if(t||""===t){var i=t[c];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(o.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=E,a(S,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:w,configurable:!0}),w.displayName=h(E,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,h(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(P.prototype),h(P.prototype,l,(function(){return this})),t.AsyncIterator=P,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new P(d(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(S),h(S,u,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:O(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}function c(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function l(){var e;return e=i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Начинаем инициализацию Rapier.js..."),"undefined"==typeof RAPIER){e.next=4;break}return console.log("Rapier.js уже загружен из глобального объекта"),e.abrupt("return",RAPIER);case 4:if(e.prev=4,"undefined"==typeof window||!window.RAPIER){e.next=8;break}return console.log("Используем Rapier.js из window.RAPIER"),e.abrupt("return",window.RAPIER);case 8:if("undefined"==typeof RAPIER||"function"!=typeof RAPIER.init){e.next=13;break}return console.log("Инициализируем Rapier.js через RAPIER.init()"),e.next=12,RAPIER.init();case 12:return e.abrupt("return",RAPIER);case 13:throw new Error("Rapier.js не найден в глобальном пространстве имен");case 16:return e.prev=16,e.t0=e.catch(4),console.warn("Не удалось инициализировать Rapier.js из глобального пространства:",e.t0),e.prev=19,console.log("Пытаемся дождаться загрузки Rapier.js..."),t=new Promise((function(e,t){var n=0,i=function(){if(n++,void 0!==window.RAPIER)return console.log("RAPIER найден после ".concat(n," попыток")),void e(window.RAPIER);n>=10?t(new Error("RAPIER не загрузился после ".concat(10," попыток"))):setTimeout(i,300)};i()})),e.next=24,t;case 24:return e.abrupt("return",e.sent);case 27:return e.prev=27,e.t1=e.catch(19),console.error("Все попытки инициализации Rapier.js завершились неудачей:",e.t1),e.abrupt("return",(console.warn("Создание заглушки Rapier.js. Физика НЕ будет работать корректно!"),{World:function(){return a((function e(){r(this,e),console.warn("Используется заглушка World вместо настоящего Rapier.js"),this.bodies=[],this.colliders=[]}),[{key:"step",value:function(){}},{key:"createRigidBody",value:function(){return{translation:function(){return{x:0,y:0,z:0}},setTranslation:function(){}}}},{key:"createCollider",value:function(){return{}}},{key:"castRay",value:function(){return null}},{key:"castRayAndGetNormal",value:function(){return{hasHit:!1,toi:0}}}])}(),RigidBodyDesc:{fixed:function(){return{setTranslation:function(){return{}}}},dynamic:function(){return{setTranslation:function(){return{}},setCanSleep:function(){return{}},setLinearDamping:function(){return{}}}}},ColliderDesc:{cuboid:function(){return{}},capsule:function(){return{}}},Ray:a((function e(t,n){r(this,e),this.origin=t,this.dir=n}))}));case 31:case"end":return e.stop()}}),e,null,[[4,16],[19,27]])})),l=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){c(o,i,r,a,s,"next",e)}function s(e){c(o,i,r,a,s,"throw",e)}a(void 0)}))},l.apply(this,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRapier=function(){return"undefined"!=typeof RAPIER?RAPIER:"undefined"!=typeof window&&window.RAPIER?window.RAPIER:null},t.initRapier=function(){return l.apply(this,arguments)},t.isRapierAvailable=function(){return"undefined"!=typeof RAPIER||"undefined"!=typeof window&&window.RAPIER}},745:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0,t.Renderer=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=t,this.scene=null,this.camera=null,this.renderer=null,this.lights=[],this.models={},this.textures={},this.visionSystem=null,this.temporaryObjects=[]},t=[{key:"setupScene",value:function(){var e=this;this.scene=new THREE.Scene,this.scene.background=new THREE.Color(8900331);var t=window.innerWidth/window.innerHeight;this.camera=new THREE.PerspectiveCamera(75,t,.1,1e3),this.camera.position.set(0,30,30),this.camera.lookAt(0,0,0),this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.setupLights(),this.createGround(),this.visionSystem=null,window.addEventListener("resize",(function(){e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(window.innerWidth,window.innerHeight)}))}},{key:"setupLights",value:function(){var e=new THREE.DirectionalLight(16777215,1);e.position.set(10,30,10),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=100,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50,this.scene.add(e),this.lights.push(e);var t=new THREE.AmbientLight(5263440,.7);this.scene.add(t),this.lights.push(t)}},{key:"createGround",value:function(){var e=new THREE.PlaneGeometry(1e3,1e3,100,100),t=new THREE.MeshStandardMaterial({color:4089145,roughness:1,metalness:0}),n=new THREE.Mesh(e,t);n.rotation.x=-Math.PI/2,n.position.y=-.5,n.receiveShadow=!0,this.scene.add(n)}},{key:"createTemporaryBeam",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16711680,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,o=new THREE.LineBasicMaterial({color:i,transparent:!0,opacity:.8}),a=new THREE.BufferGeometry,s=[new THREE.Vector3(e.x,e.y,e.z),new THREE.Vector3(t.x,t.y,t.z)];a.setFromPoints(s);var c=new THREE.Line(a,o);this.scene.add(c);var l={object:c,endTime:Date.now()+r};this.temporaryObjects.push(l),setTimeout((function(){n.removeTemporaryObject(l)}),r)}},{key:"removeTemporaryObject",value:function(e){if(e&&e.object){this.scene.remove(e.object);var t=this.temporaryObjects.indexOf(e);-1!==t&&this.temporaryObjects.splice(t,1),e.object.geometry&&e.object.geometry.dispose(),e.object.material&&e.object.material.dispose()}}},{key:"cleanTemporaryObjects",value:function(){var e=this,t=Date.now();this.temporaryObjects=this.temporaryObjects.filter((function(n){return!(n.endTime<=t&&(e.scene.remove(n.object),n.object.geometry&&n.object.geometry.dispose(),n.object.material&&n.object.material.dispose(),1))}))}},{key:"addPlayer",value:function(e){var t=new THREE.CylinderGeometry(.5,.5,1.8,8),n=new THREE.MeshStandardMaterial({color:2003199,roughness:.7}),i=new THREE.Mesh(t,n);i.position.copy(e.position),i.castShadow=!0,i.receiveShadow=!0;var r=new THREE.BoxGeometry(.1,.1,1),o=new THREE.MeshStandardMaterial({color:3355443,roughness:.5}),a=new THREE.Mesh(r,o);return a.position.set(.5,0,.5),i.add(a),this.scene.add(i),i}},{key:"updateCamera",value:function(e){this.camera&&(this.camera.position.x=e.x,this.camera.position.z=e.z+30,this.camera.lookAt(e.x,e.y,e.z))}},{key:"updateObjectTransform",value:function(e,t,n){e&&(t&&(e.position.x=t.x,e.position.y=t.y,e.position.z=t.z),n&&(e.rotation.y=n.y))}},{key:"render",value:function(e){this.renderer&&this.scene&&this.camera&&(this.visionSystem&&e&&this.visionSystem.update(),this.cleanTemporaryObjects(),this.renderer.render(this.scene,this.camera))}},{key:"setQuality",value:function(e){if(this.renderer)switch(e){case"low":this.renderer.setPixelRatio(1),this.renderer.shadowMap.enabled=!1;break;case"medium":this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFShadowMap;break;case"high":this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=THREE.PCFSoftShadowMap}}},{key:"addItem",value:function(e){var t,n;switch(e.type){case"weapon":t=new THREE.BoxGeometry(.8,.3,.2),n=new THREE.MeshStandardMaterial({color:16733986});break;case"medkit":t=new THREE.BoxGeometry(.5,.3,.5),n=new THREE.MeshStandardMaterial({color:5025616});break;case"ammo":t=new THREE.BoxGeometry(.3,.3,.3),n=new THREE.MeshStandardMaterial({color:16761095});break;default:t=new THREE.SphereGeometry(.3,8,8),n=new THREE.MeshStandardMaterial({color:13421772})}var i=new THREE.Mesh(t,n);return i.position.copy(e.position),i.position.y=.2,i.castShadow=!0,i.receiveShadow=!0,this.scene.add(i),i}},{key:"addNPC",value:function(e){var t=new THREE.CylinderGeometry(.5,.5,1.8,8),n=new THREE.MeshStandardMaterial({color:"enemy"===e.type?16711680:65280,roughness:.7}),i=new THREE.Mesh(t,n);return i.position.copy(e.position),i.castShadow=!0,i.receiveShadow=!0,this.scene.add(i),i}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()},966:(e,t)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function s(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkManager=void 0,t.NetworkManager=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=null,this.connected=!1,this.serverUrl="wss://your-server-url.com",this.mockMode=!0,this.eventHandlers={connect:[],disconnect:[],error:[],message:[],playerMove:[],playerShoot:[],playerDamage:[],itemPickup:[],npcSpawn:[],npcMove:[],gameState:[]},this.mockData={players:{},npcs:{},items:{}},this.playerId="local_player"},(t=[{key:"connect",value:function(){var e=this;return new Promise((function(t){console.log("Запущен режим прототипа (без сервера)"),e.connected=!0,e.generateMockData(),setTimeout((function(){e.eventHandlers.connect.forEach((function(e){return e()})),e.startMockNpcMovement(),t()}),500)}))}},{key:"generateMockData",value:function(){for(var e=0;e<15;e++){var t="item_".concat(e),n=80*(Math.random()-.5),i=80*(Math.random()-.5),r=["weapon","medkit","ammo"],o=r[Math.floor(Math.random()*r.length)];this.mockData.items[t]={id:t,type:o,position:{x:n,y:0,z:i},properties:{}}}for(var a=0;a<5;a++){var s="npc_".concat(a),c=80*(Math.random()-.5),l=80*(Math.random()-.5);this.mockData.npcs[s]={id:s,type:"enemy",position:{x:c,y:0,z:l},health:100,state:"patrol"}}}},{key:"startMockNpcMovement",value:function(){var e=this;setInterval((function(){Object.keys(e.mockData.npcs).forEach((function(t){var n=e.mockData.npcs[t],i=2*(Math.random()-.5),r=2*(Math.random()-.5);n.position.x+=i,n.position.z+=r,n.position.x=Math.max(-45,Math.min(45,n.position.x)),n.position.z=Math.max(-45,Math.min(45,n.position.z)),e.eventHandlers.npcMove.forEach((function(e){return e({id:t,position:n.position})}))}))}),1e3)}},{key:"on",value:function(e,t){this.eventHandlers[e]&&this.eventHandlers[e].push(t)}},{key:"sendPlayerMove",value:function(e,t){this.connected&&this.mockMode&&(this.mockData.players[this.playerId]=r(r({},this.mockData.players[this.playerId]),{},{position:e,rotation:t}))}},{key:"sendPlayerShoot",value:function(e,t,n){this.connected&&console.log("Выстрел игрока:",{position:e,direction:t,weapon:n})}},{key:"sendItemPickup",value:function(e,t){this.connected&&(console.log("Подбор предмета:",{itemId:e,itemType:t}),this.mockMode&&delete this.mockData.items[e])}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}(()=>{var e=n(745),t=n(432),i=n(966),r=n(39),o=n(172),a=n(273),s=n(91),c=n(150);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(){u=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var o=t&&t.prototype instanceof b?t:b,a=Object.create(o.prototype),s=new A(i||[]);return r(a,"_invoke",{value:C(e,n,s)}),a}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var f="suspendedStart",p="suspendedYield",m="executing",v="completed",g={};function b(){}function w(){}function E(){}var k={};h(k,a,(function(){return this}));var x=Object.getPrototypeOf,R=x&&x(x(O([])));R&&R!==n&&i.call(R,a)&&(k=R);var S=E.prototype=b.prototype=Object.create(k);function M(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,t){function n(r,o,a,s){var c=y(e[r],e,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==l(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var o;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return o=o?o.then(r,r):r()}})}function C(t,n,i){var r=f;return function(o,a){if(r===m)throw Error("Generator is already running");if(r===v){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var c=j(s,i);if(c){if(c===g)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=v,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=m;var l=y(t,n,i);if("normal"===l.type){if(r=i.done?v:p,l.arg===g)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=v,i.method="throw",i.arg=l.arg)}}}function j(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var o=y(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(l(t)+" is not iterable")}return w.prototype=E,r(S,"constructor",{value:E,configurable:!0}),r(E,"constructor",{value:w,configurable:!0}),w.displayName=h(E,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,h(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(P.prototype),h(P.prototype,s,(function(){return this})),t.AsyncIterator=P,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new P(d(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(S),h(S,c,"Generator"),h(S,a,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;T(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:O(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),g}},t}function h(e,t,n,i,r,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){h(o,i,r,a,s,"next",e)}function s(e){h(o,i,r,a,s,"throw",e)}a(void 0)}))}}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function f(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}function p(e){"undefined"!=typeof window&&window.debugLog?window.debugLog("Game",e):console.log("[Game] ".concat(e))}var m=function(){return n=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p("Инициализация игры..."),this.isRunning=!1,this.isLoading=!0,this.currentScene="loading",this.loadingScreen=document.getElementById("loading-screen"),this.mainMenu=document.getElementById("main-menu"),this.gameCanvas=document.getElementById("game-canvas"),this.hudElement=document.getElementById("hud"),this.inventoryScreen=document.getElementById("inventory-screen"),this.loadingStatus=document.getElementById("loading-status"),this.updateLoadingStatus("Инициализация игры..."),window.addEventListener("error",this.handleGlobalError.bind(this)),window.addEventListener("unhandledrejection",this.handlePromiseError.bind(this)),this.player=null,this.entities=[],this.gameTime=0,this.physicsUpdateRate=1/60,this.physicsAccumulator=0,this.fogOfWarEnabled=!0,this.visibilitySystemEnabled=!0,this.update=this.update.bind(this),this.fixedUpdate=this.fixedUpdate.bind(this),this.startGame=this.startGame.bind(this),this.initModules().then((function(){return p("Основные модули инициализированы"),t.loadResources()})).then((function(){p("Ресурсы загружены"),t.showMainMenu()})).catch((function(e){p("Ошибка инициализации: ".concat(e.message)),t.showErrorScreen("Произошла ошибка при инициализации: ".concat(e.message))}))},l=[{key:"initModules",value:(f=d(u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,this.updateLoadingStatus("Инициализация рендерера..."),this.renderer=new e.Renderer(this.gameCanvas),this.updateLoadingStatus("Инициализация обработчика ввода..."),this.input=new t.InputHandler,this.updateLoadingStatus("Инициализация сетевого менеджера..."),this.network=new i.NetworkManager,this.updateLoadingStatus("Инициализация физического движка..."),this.physics=new s.PhysicsManager,this.updateLoadingStatus("Инициализация UI компонентов..."),this.ui={hud:new o.HUD(this.hudElement),inventory:new a.InventoryUI(this.inventoryScreen)},this.setupEventListeners(),this.lastFrameTime=0,n.abrupt("return",!0);case 16:throw n.prev=16,n.t0=n.catch(0),p("Ошибка инициализации модулей: ".concat(n.t0.message)),n.t0;case 20:case"end":return n.stop()}}),n,this,[[0,16]])}))),function(){return f.apply(this,arguments)})},{key:"updateLoadingStatus",value:function(e){this.loadingStatus&&(this.loadingStatus.textContent=e),p(e)}},{key:"handleGlobalError",value:function(e){p("Глобальная ошибка: ".concat(e.message," в ").concat(e.filename,":").concat(e.lineno)),"loading"===this.currentScene&&this.showErrorScreen("Ошибка: ".concat(e.message)),e.preventDefault()}},{key:"handlePromiseError",value:function(e){var t,n=(null===(t=e.reason)||void 0===t?void 0:t.message)||"Неизвестная ошибка Promise";p("Необработанная ошибка Promise: ".concat(n)),"loading"===this.currentScene&&this.showErrorScreen("Ошибка асинхронной операции: ".concat(n)),e.preventDefault()}},{key:"showErrorScreen",value:function(e){var t=document.getElementById("error-screen");if(t){var n=document.getElementById("error-message");n&&(n.textContent=e)}else{(t=document.createElement("div")).id="error-screen",t.className="error-overlay",t.innerHTML='\n                <div class="error-container">\n                    <h2>Произошла ошибка</h2>\n                    <p id="error-message">'.concat(e,'</p>\n                    <button id="reload-button">Перезагрузить</button>\n                </div>\n            '),document.body.appendChild(t);var i=document.getElementById("reload-button");i&&i.addEventListener("click",(function(){window.location.reload()}));var r=document.createElement("style");r.textContent="\n                .error-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background-color: rgba(0, 0, 0, 0.85);\n                    z-index: 9999;\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                }\n                .error-container {\n                    background-color: #333;\n                    padding: 20px;\n                    border: 2px solid #f44336;\n                    max-width: 80%;\n                    text-align: center;\n                }\n                .error-container h2 {\n                    color: #f44336;\n                    margin-bottom: 15px;\n                }\n                .error-container p {\n                    color: #fff;\n                    margin-bottom: 20px;\n                    font-family: monospace;\n                    white-space: pre-wrap;\n                    text-align: left;\n                }\n                #reload-button {\n                    background-color: #4CAF50;\n                    color: white;\n                    border: none;\n                    padding: 10px 20px;\n                    cursor: pointer;\n                    font-size: 16px;\n                }\n                #reload-button:hover {\n                    background-color: #45a049;\n                }\n            ",document.head.appendChild(r)}this.loadingScreen&&this.loadingScreen.classList.add("hidden")}},{key:"loadResources",value:(h=d(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateLoadingStatus("Инициализация физического движка..."),e.prev=1,e.next=4,this.physics.init();case 4:if(e.sent){e.next=7;break}throw new Error("Не удалось инициализировать физику");case 7:return this.updateLoadingStatus("Физический движок инициализирован"),this.updateLoadingStatus("Загрузка игровых ресурсов..."),e.next=11,new Promise((function(e){setTimeout((function(){t.isLoading=!1,e()}),1e3)}));case 11:return this.updateLoadingStatus("Все ресурсы загружены успешно"),e.abrupt("return",!0);case 15:throw e.prev=15,e.t0=e.catch(1),p("Ошибка загрузки ресурсов: ".concat(e.t0.message)),e.t0;case 19:case"end":return e.stop()}}),e,this,[[1,15]])}))),function(){return h.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var e=this;try{var t=document.getElementById("start-game");t&&t.addEventListener("click",this.startGame);var n=document.getElementById("settings");n&&n.addEventListener("click",(function(){p("Настройки")}));var i=document.getElementById("close-inventory");if(i&&i.addEventListener("click",(function(){e.hideInventory()})),this.input&&(this.input.addKeyCallback("KeyI",(function(){"game"===e.currentScene&&e.toggleInventory()})),this.input.addKeyCallback("Escape",(function(){"game"===e.currentScene&&e.togglePause()}))),window.vkBridge)try{window.vkBridge.send("VKWebAppInit"),p("VK Bridge инициализирован")}catch(e){p("Ошибка инициализации VK Bridge: ".concat(e.message))}window.addEventListener("resize",(function(){e.renderer&&e.renderer.render(e.player)})),p("Обработчики событий настроены")}catch(e){throw p("Ошибка настройки обработчиков событий: ".concat(e.message)),e}}},{key:"showMainMenu",value:function(){this.loadingScreen&&this.loadingScreen.classList.add("hidden"),this.mainMenu&&this.mainMenu.classList.remove("hidden"),this.currentScene="menu",p("Главное меню отображено")}},{key:"startGame",value:function(){try{p("Запуск игры..."),this.mainMenu&&this.mainMenu.classList.add("hidden"),this.gameCanvas&&this.gameCanvas.classList.remove("hidden"),this.hudElement&&this.hudElement.classList.remove("hidden"),this.isRunning=!0,this.currentScene="game",this.renderer&&(this.renderer.setupScene(),p("Сцена настроена")),this.createTestWalls(),this.player=new r.Player({position:{x:0,y:0,z:0},renderer:this.renderer,input:this.input,game:this}),p("Игрок создан"),this.initVisionSystem(),this.network.connect().then((function(){p("Подключено к серверу (прототип)")})).catch((function(e){p("Ошибка подключения: ".concat(e.message))})),this.lastFrameTime=performance.now(),requestAnimationFrame(this.update),p("Игра запущена")}catch(e){p("Ошибка при запуске игры: ".concat(e.message)),this.showErrorScreen("Ошибка при запуске игры: ".concat(e.message))}}},{key:"initVisionSystem",value:function(){try{if(!this.renderer||!this.renderer.scene||!this.player)throw new Error("Не все компоненты доступны для инициализации системы видимости");p("Инициализация системы видимости...");var e=new c.VisionSystem({scene:this.renderer.scene,world:this.physics.getWorld(),player:this.player,fov:90,rayCount:60,maxDistance:50,memoryEnabled:!0,blurEdges:!0});this.renderer.visionSystem=e,p("Система видимости инициализирована")}catch(e){throw p("Ошибка инициализации системы видимости: ".concat(e.message)),e}}},{key:"createTestWalls",value:function(){var e=this;try{if(!(this.physics&&this.physics.isReady()&&this.renderer&&this.renderer.scene))return void p("Физика или рендерер не готовы для создания стен");p("Создание тестовых стен...");var t=new THREE.MeshStandardMaterial({color:8421504,roughness:.7,metalness:.2}),n=function(n,i,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,s=new THREE.BoxGeometry(r,a,o),c=new THREE.Mesh(s,t);return c.position.set(n,a/2,i),e.renderer.scene.add(c),e.physics.createObstacle({position:{x:n,y:a/2,z:i},size:{x:r,y:a,z:o},object:c}),c};n(0,-20,40,1),n(-20,0,1,40),n(20,0,1,40),n(0,20,40,1),n(-10,-10,1,20),n(10,10,20,1),n(10,-5,1,10),n(-5,5,10,1),n(-15,-15,3,3),n(15,-15,3,3),n(15,15,3,3),n(-15,15,3,3),p("Тестовые стены созданы")}catch(e){p("Ошибка создания тестовых стен: ".concat(e.message))}}},{key:"togglePause",value:function(){this.isRunning?this.pauseGame():this.resumeGame()}},{key:"pauseGame",value:function(){this.isRunning=!1,this.input&&this.input.disableGameControls(),p("Игра на паузе")}},{key:"resumeGame",value:function(){this.isRunning=!0,this.input&&this.input.enableGameControls(),p("Игра возобновлена"),this.lastFrameTime=performance.now(),requestAnimationFrame(this.update)}},{key:"fixedUpdate",value:function(e){try{this.network&&this.network.isConnected,this.entities.forEach((function(t){t.fixedUpdate&&t.fixedUpdate(e)}))}catch(e){p("Ошибка в fixedUpdate: ".concat(e.message))}}},{key:"update",value:function(e){if(this.isRunning)try{var t=performance.now(),n=(t-this.lastFrameTime)/1e3;this.lastFrameTime=t;var i=Math.min(n,.1);for(this.gameTime+=i,this.physicsAccumulator+=i;this.physicsAccumulator>=this.physicsUpdateRate;)this.physics&&this.physics.isReady()&&this.physics.update(this.physicsUpdateRate),this.fixedUpdate(this.physicsUpdateRate),this.physicsAccumulator-=this.physicsUpdateRate;this.player&&this.player.update(i),this.entities.forEach((function(e){e.update&&e.update(i)})),this.renderer&&this.renderer.render(this.player),this.updateUI(),requestAnimationFrame(this.update)}catch(e){p("Ошибка в игровом цикле: ".concat(e.message)),requestAnimationFrame(this.update)}}},{key:"updateUI",value:function(){this.player&&this.ui.hud&&this.ui.hud.update({health:this.player.health,ammo:this.player.ammo,weapon:this.player.weapon})}},{key:"toggleInventory",value:function(){this.inventoryScreen.classList.contains("hidden")?this.showInventory():this.hideInventory()}},{key:"showInventory",value:function(){this.inventoryScreen.classList.remove("hidden"),this.ui.inventory&&this.ui.inventory.show(),this.input&&this.input.disableGameControls()}},{key:"hideInventory",value:function(){this.inventoryScreen.classList.add("hidden"),this.ui.inventory&&this.ui.inventory.hide(),this.input&&this.input.enableGameControls()}},{key:"addEntity",value:function(e){this.entities.push(e)}},{key:"removeEntity",value:function(e){var t=this.entities.indexOf(e);-1!==t&&this.entities.splice(t,1)}},{key:"endGame",value:function(){this.isRunning=!1,this.currentScene="menu",this.entities=[],this.renderer&&this.renderer.visionSystem&&(this.renderer.visionSystem.dispose(),this.renderer.visionSystem=null),this.physics&&this.physics.dispose(),this.player&&(this.player=null),this.gameCanvas&&this.gameCanvas.classList.add("hidden"),this.hudElement&&this.hudElement.classList.add("hidden"),this.mainMenu&&this.mainMenu.classList.remove("hidden"),p("Игра завершена")}}],l&&y(n.prototype,l),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,l,h,f}();document.addEventListener("DOMContentLoaded",(function(){try{p("DOMContentLoaded: инициализация игры"),window.game=new m}catch(t){console.error("Критическая ошибка при инициализации игры:",t);var e=document.createElement("div");e.style.cssText="\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            padding: 20px;\n            background-color: #f44336;\n            color: white;\n            text-align: center;\n            font-size: 18px;\n            z-index: 9999;\n        ",e.textContent="Критическая ошибка: ".concat(t.message),document.body.appendChild(e)}}))})()})();
//# sourceMappingURL=bundle.js.map