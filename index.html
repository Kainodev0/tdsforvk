<!doctype html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TDS Escape</title><link rel="stylesheet" href="styles.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r133/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.133.0/examples/js/loaders/GLTFLoader.js"></script><script src="https://cdn.jsdelivr.net/npm/@dimforge/rapier3d-compat@0.11.2/rapier.min.js"></script></head><body><div id="game-container"><div id="loading-screen"><div class="loader"></div><div class="loading-text">Загрузка игры...</div><div id="loading-status">Инициализация...</div></div><canvas id="game-canvas" class="hidden"></canvas><div id="hud" class="hidden"><div id="health-bar"><div class="health-value"></div></div><div id="ammo-counter"></div><div id="weapon-info"></div><div id="status-messages"></div></div></div><script>// Переменная для отслеживания состояния загрузки
        window.gameLoaded = false;
        
        // Функция для автозапуска игры
        function autoStartGame() {
            if (window.game && typeof window.game.startGame === 'function') {
                // Запускаем игру
                window.game.startGame();
                console.log('Игра автоматически запущена');
                window.gameLoaded = true;
            } else {
                console.log('Ожидание загрузки игры...');
                setTimeout(autoStartGame, 500);
            }
        }
        
        // Функция для загрузки скрипта игры
        function loadGameScript() {
            console.log('Загрузка скрипта игры...');
            var script = document.createElement('script');
            script.src = 'bundle.js';
            script.type = 'text/javascript';
            script.onload = function() {
                console.log('Скрипт игры загружен, инициализация...');
                // Запускаем проверку готовности игры
                setTimeout(autoStartGame, 500);
            };
            script.onerror = function(error) {
                console.error('Ошибка загрузки скрипта игры:', error);
                document.getElementById('loading-status').textContent = 'Ошибка загрузки. Попробуйте обновить страницу.';
            };
            document.body.appendChild(script);
        }
        
        // Запускаем загрузку при готовности DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM загружен, проверка библиотек...');
            // Проверяем загрузку библиотек
            if (typeof THREE !== 'undefined' && typeof RAPIER !== 'undefined') {
                console.log('Библиотеки загружены успешно');
                document.getElementById('loading-status').textContent = 'Загрузка игровых ресурсов...';
                loadGameScript();
            } else {
                console.error('Ошибка загрузки библиотек!');
                document.getElementById('loading-status').textContent = 'Ошибка загрузки библиотек. Попробуйте обновить страницу.';
            }
        });

        // Резервный запуск при полной загрузке страницы
        window.addEventListener('load', function() {
            console.log('Страница полностью загружена');
            if (!window.gameLoaded) {
                console.log('Запуск резервного механизма загрузки');
                loadGameScript();
            }
        });</script><script defer="defer" src="/tdsforvk/bundle.js"></script></body></html>